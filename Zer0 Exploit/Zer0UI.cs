using ScintillaNET;
using System;
using System.Diagnostics;
using System.Drawing;
using System.IO;
using System.Net;
using System.Runtime.InteropServices;
using System.Text;
using System.Windows.Forms;
using Microsoft.VisualBasic.CompilerServices;
using System.Collections.Generic;
namespace Zer0
{
    public partial class Zer0UI : Form
    {
        public Zer0UI()
        {
            InitializeComponent();
        }

        private string dllName = "C:/Bleu/LoadHack.dll";

        [DllImport("kernel32.dll", CharSet = CharSet.None, ExactSpelling = false)]
        public static extern IntPtr OpenProcess(int dwDesiredAccess, bool bInheritHandle, int dwProcessId);

        [DllImport("kernel32.dll", CharSet = CharSet.None, ExactSpelling = false, SetLastError = true)]
        private static extern bool WriteProcessMemory(IntPtr hProcess, IntPtr lpBaseAddress, byte[] lpBuffer, uint nSize, out UIntPtr lpNumberOfBytesWritten);

        [DllImport("kernel32.dll", CharSet = CharSet.None, ExactSpelling = true, SetLastError = true)]
        private static extern IntPtr VirtualAllocEx(IntPtr hProcess, IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);

        [DllImport("kernel32.dll", CharSet = CharSet.None, ExactSpelling = false)]
        private static extern IntPtr CreateRemoteThread(IntPtr hProcess, IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);


        [DllImport("kernel32", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
        private static extern IntPtr GetProcAddress(IntPtr hModule, string procName);

        [DllImport("kernel32.dll", CharSet = CharSet.Auto, ExactSpelling = false)]
        public static extern IntPtr GetModuleHandle(string lpModuleName);

        IntPtr procAddress = GetProcAddress(GetModuleHandle("kernel32.dll"), "LoadLibraryA");

        private int Inject(string dllName)

        {
            int num;
            try
            {
                Process processesByName = Process.GetProcessesByName("RobloxPlayerBeta")[0];
                if (processesByName == null)
                {
                    File.Create("00");
                }
                else if (processesByName.MainWindowHandle.ToInt32() != 0)
                {
                    IntPtr intPtr = OpenProcess(1082, false, processesByName.Id);
                    IntPtr intPtr1 = VirtualAllocEx(intPtr, IntPtr.Zero, (uint)((dllName.Length + 1) * Marshal.SizeOf(typeof(char))), 12288, 4);
                    WriteProcessMemory(intPtr, intPtr1, Encoding.Default.GetBytes(dllName), (uint)((dllName.Length + 1) * Marshal.SizeOf(typeof(char))), out UIntPtr uIntPtr);
                    CreateRemoteThread(intPtr, IntPtr.Zero, 0, procAddress, intPtr1, 0, IntPtr.Zero);


                }
                num = 0;
            }
            catch (Exception exception)
            {
                MessageBox.Show("Failed Injection: " + exception + "\n" + "\n" + "Please DM Moog#7778 on discord for more assistance!");
                num = 0;
            }
            return num;
        }

        private void Zer0UI_Load(object sender, EventArgs e)
        {
            //Timers Start
            TogglerLabel.Text = Properties.Settings.Default.AutoInjToggler;
            TogglerLabel2.Text = Properties.Settings.Default.TopMostToggler;
            // Start of AutoInjection Toggle
            if (TogglerLabel.Text == "rodfpq")
            {
                AutoInjection.Start();
                AutoInjectToggler.Checked = true;
            }
            else
            {
                AutoInjection.Stop();
                AutoInjectToggler.Checked = false;
            }
            // End of AutoInjection Toggle
            // Start of TopMost Toggle
            if (TogglerLabel2.Text == "wrjiow")
            {
                TopMost = true;
                TopMostToggler.Checked = true;
            }
            else
            {
                TopMost = false;
                TopMostToggler.Checked = false;
            }
            // End of TopMost Toggle
            CheckForUpdates();
            Zer0CheckForUpdates();
            Zer0AutoRefresh.Start();
            AutoRefresh.Start();
            //Timers End
            //Bleu TextBox
            string Bleustr = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
            string Bleustr2 = "0123456789";
            string Bleustr3 = "ŠšŒœŸÿÀàÁáÂâÃãÄäÅåÆæÇçÈèÉéÊêËëÌìÍíÎîÏïÐðÑñÒòÓóÔôÕõÖØøÙùÚúÛûÜüÝýÞþßö";
            this.BleuTextBox.StyleResetDefault();
            this.BleuTextBox.Styles[32].Font = "Consolas";
            this.BleuTextBox.Styles[32].Size = 10;
            this.BleuTextBox.StyleClearAll();
            this.BleuTextBox.Styles[0].ForeColor = Color.Silver;
            this.BleuTextBox.Styles[1].ForeColor = Color.FromArgb(0, 0, 127, 0);
            this.BleuTextBox.Styles[2].ForeColor = Color.FromArgb(0, 0, 127, 0);
            this.BleuTextBox.Styles[4].ForeColor = Color.FromArgb(0, 0, 127, 127);
            this.BleuTextBox.Styles[5].ForeColor = Color.FromArgb(0, 0, 0, 127);
            this.BleuTextBox.Styles[13].ForeColor = Color.FromArgb(0, 255, 128, 0);
            this.BleuTextBox.Styles[14].ForeColor = Color.FromArgb(0, 255, 0, 0);
            this.BleuTextBox.Styles[15].ForeColor = Color.DarkSlateBlue;
            this.BleuTextBox.Styles[6].ForeColor = Color.FromArgb(0, 127, 0, 127);
            this.BleuTextBox.Styles[7].ForeColor = Color.FromArgb(0, 127, 0, 127);
            this.BleuTextBox.Styles[8].ForeColor = Color.FromArgb(0, 127, 0, 127);
            this.BleuTextBox.Styles[10].ForeColor = Color.FromArgb(0, 127, 127, 127);
            this.BleuTextBox.Styles[9].ForeColor = Color.Maroon;
            this.BleuTextBox.Lexer = Lexer.Lua;
            this.BleuTextBox.WordChars = Bleustr + Bleustr2 + Bleustr3;
            this.BleuTextBox.SetKeywords(0, "info and break do else elseif end for function if in local nil not or repeat return then until while false true goto assert collectgarbage dofile _G getmetatable ipairs loadfile next pairs pcall print rawequal rawget rawset setmetatable tonumber tostring type _VERSION xpcall string table math coroutine io os debug getfenv gcinfo load loadlib loadstring require select setfenv unpack _LOADED LUA_PATH _REQUIREDNAME package rawlen package bit32 utf8 _ENV string.byte string.char string.dump string.find string.format string.gsub string.len string.lower string.rep string.sub string.upper table.concat table.insert table.remove table.sort math.abs math.acos math.asin math.atan math.atan2 math.ceil math.cos math.deg math.exp math.floor math.frexp math.ldexp math.log math.max math.min math.pi math.pow math.rad math.random math.randomseed math.sin math.sqrt math.tan string.gfind string.gmatch string.match string.reverse string.pack string.packsize string.unpack table.foreach table.foreachi table.getn table.setn table.maxn table.pack table.unpack table.move math.cosh math.fmod math.huge math.log10 math.modf math.mod math.sinh math.tanh math.maxinteger math.mininteger math.tointeger math.type math.ult bit32.arshift bit32.band bit32.bnot bit32.bor bit32.btest bit32.bxor bit32.extract bit32.replace bit32.lrotate bit32.lshift bit32.rrotate bit32.rshift utf8.char utf8.charpattern utf8.codes utf8.codepoint utf8.len utf8.offset coroutine.create coroutine.resume coroutine.status coroutine.wrap coroutine.yield io.close io.flush io.input io.lines io.open io.output io.read io.tmpfile io.type io.write io.stdin io.stdout io.stderr os.clock os.date os.difftime os.execute os.exit os.getenv os.remove os.rename os.setlocale os.time os.tmpname coroutine.isyieldable coroutine.running io.popen module package.loaders package.seeall package.config package.searchers package.searchpath require package.cpath package.loaded package.loadlib package.path package.preload wait");
            this.BleuTextBox.SetKeywords(1, "warn");
            this.BleuTextBox.SetKeywords(2, "error");
            this.BleuTextBox.SetKeywords(3, "");
            this.BleuTextBox.SetProperty("fold", "1");
            this.BleuTextBox.SetProperty("fold.compact", "1");
            this.BleuTextBox.Margins[1].Type = MarginType.Symbol;
            this.BleuTextBox.Margins[1].Mask = 4261412864u;
            this.BleuTextBox.Margins[1].Sensitive = true;
            this.BleuTextBox.Margins[1].Width = 15;
            for (int i = 25; i <= 31; i++)
            {
                this.BleuTextBox.Markers[i].SetForeColor(SystemColors.ControlLightLight);
                this.BleuTextBox.Markers[i].SetBackColor(SystemColors.ControlDark);
            }
            this.BleuTextBox.Markers[30].Symbol = MarkerSymbol.BoxPlus;
            this.BleuTextBox.Markers[31].Symbol = MarkerSymbol.BoxMinus;
            this.BleuTextBox.Markers[25].Symbol = MarkerSymbol.BoxPlusConnected;
            this.BleuTextBox.Markers[27].Symbol = MarkerSymbol.TCorner;
            this.BleuTextBox.Markers[26].Symbol = MarkerSymbol.BoxMinusConnected;
            this.BleuTextBox.Markers[29].Symbol = MarkerSymbol.VLine;
            this.BleuTextBox.Markers[28].Symbol = MarkerSymbol.LCorner;
            this.BleuTextBox.AutomaticFold = (AutomaticFold.Show | AutomaticFold.Click | AutomaticFold.Change);
            int Bleulength = this.BleuTextBox.Lines.Count.ToString().Length;
            BleuTextBox.Margins[0].Width = this.BleuTextBox.TextWidth(33, new string('9', Bleulength + 1)) + 2;
            // End Bleu TextBox
        }

        private void CheckForUpdates()
        {
            {
                Encoding Encoding = Encoding.UTF8;
            }
            try
            {
                WebClient webclient = new WebClient();
                string Updater = null;
                Updater = Encoding.ASCII.GetString((webclient.DownloadData("https://pastebin.com/raw/CfSki4UN")));
                NEEDEDFORUPDATELabel.Text = (Updater);
                if (NEEDEDFORUPDATELabel.Text == "Update!")
                {
                    // Settings Tab #1
                    BlueUpdateButton.Visible = true;
                    BlueYesUpdateLabel.Visible = true;
                    BlueNoUpdateStatusLabel.Visible = false;
                    BlueNoUpdateStatusLabel.Location = new Point(167, 95);
                    BlueUpdateStatusLabel.Location = new Point(157, 78);

                }
                else
                {
                    // Settings Tab #1
                    BlueUpdateButton.Visible = false;
                    BlueYesUpdateLabel.Visible = false;
                    BlueNoUpdateStatusLabel.Visible = true;
                    BlueNoUpdateStatusLabel.Location = new Point(167, 95);
                    BlueUpdateStatusLabel.Location = new Point(157, 78);
                }
            }
            catch
            {
                // Moog Updater
            }
        }

        private void Zer0CheckForUpdates()
        {
            {
                Encoding Encoding = Encoding.UTF8;
            }
            try
            {
                WebClient webclient = new WebClient();
                string Updater = null;
                Updater = Encoding.ASCII.GetString((webclient.DownloadData("https://pastebin.com/raw/ndSYynbM")));
                updatelabel2.Text = (Updater);
                if (updatelabel2.Text == "Update!")
                {
                    // Settings Tab #2
                    Zer0UpdateButton.Visible = true;
                    Zer0YesUpdateLabel.Visible = true;
                    Zer0NoUpdateStatusLabel.Visible = false;
                    Zer0NoUpdateStatusLabel.Location = new Point(167, 225);
                    Zer0UpdateStatusLabel.Location = new Point(157, 208);

                }
                else
                {
                    // Settings Tab #2
                    Zer0UpdateButton.Visible = false;
                    Zer0YesUpdateLabel.Visible = false;
                    Zer0NoUpdateStatusLabel.Visible = true;
                    Zer0NoUpdateStatusLabel.Location = new Point(167, 225);
                    Zer0UpdateStatusLabel.Location = new Point(157, 208);
                }
            }
            catch
            {
                // Moog Updater
            }
        }

        private void AutoRefresh_Tick(object sender, EventArgs e)
        {
            CheckForUpdates();
        }

        private async void BleuOpen_ClickAsync(object sender, EventArgs e)
        {
            using (OpenFileDialog BleuOpenFile = new OpenFileDialog() { Filter = ".TXT and .LUA|*.txt;*.lua", ValidateNames = true, Multiselect = false })
            {
                if (BleuOpenFile.ShowDialog() == DialogResult.OK)
                {
                    using (StreamReader sr = new StreamReader(BleuOpenFile.FileName))
                    {
                        BleuTextBox.Text = await sr.ReadToEndAsync();
                    }
                }
            }
        }
        private void BleuInject_Click(object sender, EventArgs e)
        {
            Process[] pname = Process.GetProcessesByName("robloxplayerbeta");
            try
            {
                {
                    if (pname.Length == 0)
                    {
                        MessageBox.Show("Could not find RobloxPlayerBeta.exe");
                    }
                    else
                    {
                        Inject("C:/Bleu/libcurl.dll");
                        Inject(dllName);
                        BleuInjectedLabel.ForeColor = Color.LawnGreen;
                        BleuInjectedLabel.Location = new Point(719, 305);
                        BleuInjectedLabel.Text = ("Injected");
                    }
                }
            }
            catch
            {
                MessageBox.Show("Could not find RobloxPlayerBeta.exe");
            }
        }

        bool autoinjection = false;

        private void AutoInjection_Tick(object sender, EventArgs e)
        {
            if (autoinjection != true)
            {
                Process[] pname = Process.GetProcessesByName("robloxplayerbeta");
                if (pname.Length == 0)
                {
                    BleuInjectedLabel.ForeColor = Color.Red;
                    BleuInjectedLabel.Location = new Point(707, 305);
                    BleuInjectedLabel.Text = ("Not Injected");
                }
                else
                {
                    Inject("C:/Bleu/libcurl.dll");
                    Inject(dllName);
                    BleuInjectedLabel.ForeColor = Color.LawnGreen;
                    BleuInjectedLabel.Location = new Point(719, 305);
                    BleuInjectedLabel.Text = ("Injected");
                }
            }
            else
            {
                BleuInjectedLabel.Location = new Point(707, 305);
                BleuInjectedLabel.ForeColor = Color.Red;
                BleuInjectedLabel.Text = ("Not Injected");
            }
        }

        private void BleuExecute_Click(object sender, EventArgs e)
        {
            Process[] pname = Process.GetProcessesByName("robloxplayerbeta");
            try
            {
                if (pname.Length == 0)
                {
                    MessageBox.Show("Could not find RobloxPlayerBeta.exe");
                }
                else
                {
                    File.WriteAllText("C:/Bleu/INPUT", string.Concat(1, 0, " spawn(function()\n" + BleuTextBox.Text + "\nend)"));
                }
            }
            catch
            {
                //I had to do this or Visual Studio hates me ):
            }
        }

        private void BleuClear_Click(object sender, EventArgs e)
        {
            DialogResult BleudialogResult = MessageBox.Show("Are you sure you want to clear the TextBox?" + "\n" + "This can result into loss of work.", "Are you sure you would like to clear the textbox?", MessageBoxButtons.YesNo, MessageBoxIcon.Error);
            if (BleudialogResult == DialogResult.Yes)
            {
                BleuTextBox.Text = ("");
            }
            else if (BleudialogResult == DialogResult.No)
            {
                // User promoted no, will not clear TextBox.
            }
        }
        private void AutoInjectToggler_CheckedChanged(object sender)
        {
            {
                bool flag = AutoInjectToggler.Checked == true;
                if (flag)
                {
                    AutoInjection.Start();
                    MessageBox.Show("Zer0 AutoInjection has been turned on." + "\n" + "Settings successfully Saved.", "AutoInjection turned on.", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    TogglerLabel.Text = ("rodfpq");
                }
                else
                {
                    AutoInjection.Stop();
                    MessageBox.Show("Zer0 AutoInjection has been turned off." + "\n" + "Settings successfully Saved.", "AutoInjection turned off.", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    TogglerLabel.Text = ("fkoesd");
                }
            }
        }

        private void FormClosingZero(object sender, FormClosingEventArgs e)
        {
            Properties.Settings.Default.AutoInjToggler = TogglerLabel.Text;
            Properties.Settings.Default.TopMostToggler = TogglerLabel2.Text;
            Properties.Settings.Default.Save();
        }

        private void FlatFormCloser_Click(object sender, EventArgs e)
        {
            Application.Exit();
        }

        private void BlueTextBoxChangedText(object sender, EventArgs e)
        {
            CharactersCountLabel.Text = BleuTextBox.Text.Length.ToString();
        }

        private void BlueUpdateButton_Click(object sender, EventArgs e)
        {
            try
            {
                new WebClient().DownloadFile(new Uri("https://bleu.cloris.co/Release/LoadHack.dll"), "C:/Bleu/LoadHack.dll");
                new WebClient().DownloadFile(new Uri("https://bleu.cloris.co/Release/libcurl.dll"), "C:/Bleu/libcurl.dll");
                new WebClient().DownloadFile(new Uri("https://bleu.cloris.co/Message.txt"), "C:/Bleu/Message.txt");
            }
            catch (Exception exception)
            {
                MessageBox.Show("Failed Update: " + exception + "\n" + "\n" + "Please DM Moog#7778 on discord for more assistance!");
            }
        }

        private void TopMostToggler_CheckedChanged(object sender)
        {
            {
                bool flag = TopMostToggler.Checked == true;
                if (flag)
                {
                    TopMost = true;
                    MessageBox.Show("Zer0 TopMost has been turned on." + "\n" + "Settings successfully Saved.", "TopMost turned on.", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    TogglerLabel2.Text = ("wrjiow");
                }
                else
                {
                    TopMost = false;
                    MessageBox.Show("Zer0 TopMost has been turned off." + "\n" + "Settings successfully Saved.", "TopMost turned off.", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    TogglerLabel2.Text = ("aksodi");
                }
            }
        }

        private void Zer0UpdateButton_Click(object sender, EventArgs e)
        {
            try
            {
                WebClient webclient = new WebClient();
                string Updater = null;
                Updater = Encoding.ASCII.GetString((webclient.DownloadData("https://pastebin.com/raw/TuhVxjdv")));
                updatelabel3.Text = (Updater);
                Process.Start(updatelabel3.Text);
            }
            catch (Exception exception)
            {
                MessageBox.Show("Failed Update: " + exception + "\n" + "\n" + "Please DM Moog#7778 on discord for more assistance!");
            }
        }

        private void Zer0AutoRefresh_Tick(object sender, EventArgs e)
        {
            Zer0CheckForUpdates();
        }
        private void UpdateStatusChecker_Tick(object sender, EventArgs e)
        {
            try
            {
                WebClient webclient = new WebClient();
                string Updater = null;
                Updater = Encoding.ASCII.GetString((webclient.DownloadData("https://pastebin.com/raw/gcjMBgwF")));
                updatelabel4.Text = (Updater);
                UpdateStatusLabel.Text = ("There's an update ready to install.");
                UpdateStatusLabel.Location = new Point(35, 305);
                UpdateStatusLabel.ForeColor = Color.LawnGreen;
            }
            catch
            {
                UpdateStatusLabel.Text = ("There's currently no update to display.");
                UpdateStatusLabel.Location = new Point(45, 305);
                UpdateStatusLabel.ForeColor = Color.Red;
            }
        }
    }
}